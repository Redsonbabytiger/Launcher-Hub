<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Index of /</title>
  <style>
    body { font-family: monospace; background: #fff; color: #222; margin: 2em; }
    h1 { font-size: 1.2em; }
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 4px 8px; border-bottom: 1px solid #eee; }
    th { background: #f7f7f7; text-align: left; }
    tr:hover td { background: #f0f0f0; }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .right { text-align: right; }
    .desc { color: #888; }
  </style>
</head>
<body>
  <h1>Index of <span id="path"></span></h1>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Last modified</th>
        <th class="right">Size</th>
        <th class="desc">Description</th>
      </tr>
    </thead>
    <tbody id="listing"></tbody>
  </table>
  <script>
    const owner = 'Redsonbabytiger';
    const repo = 'Launcher-Hub';
    const branch = 'gh-pages';

    // Get the current path from the URL
    let currentPath = window.location.pathname;
    
    // Handle /Launcher-Hub as root directory
    if (currentPath === '/Launcher-Hub' || currentPath === '/Launcher-Hub/') {
      currentPath = '/';
    }
    
    let path = decodeURIComponent(currentPath.replace(/^\/|\/$/g, ''));
    document.getElementById('path').textContent = '/' + path;

    async function fetchContents(path) {
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
      const response = await fetch(apiUrl);
      if (!response.ok) return [];
      return await response.json();
    }

    function formatSize(size) {
      if (size === undefined) return '';
      if (size < 1024) return size + ' B';
      if (size < 1024 * 1024) return (size / 1024).toFixed(1) + ' KB';
      return (size / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      return d.toISOString().replace('T', ' ').substring(0, 19);
    }

    async function renderListing(path) {
      const listing = document.getElementById('listing');
      listing.innerHTML = '';
      const contents = await fetchContents(path);

      // Add parent directory link if not at root
      if (path) {
        const parent = path.split('/').slice(0, -1).join('/');
        listing.innerHTML += `
          <tr>
            <td><a href="../">Parent Directory</a></td>
            <td></td>
            <td class="right"></td>
            <td class="desc"></td>
          </tr>
        `;
      }

      // Sort directories first, then files
      contents.sort((a, b) => {
        if (a.type === b.type) return a.name.localeCompare(b.name);
        return a.type === 'dir' ? -1 : 1;
      });

      for (const item of contents) {
        // Fetch commit info for last modified date
        let lastModified = '';
        try {
          const commitsUrl = `https://api.github.com/repos/${owner}/${repo}/commits?path=${encodeURIComponent(path ? path + '/' + item.name : item.name)}&sha=${branch}&per_page=1`;
          const commitsResp = await fetch(commitsUrl);
          if (commitsResp.ok) {
            const commits = await commitsResp.json();
            if (commits.length > 0) lastModified = formatDate(commits[0].commit.committer.date);
          }
        } catch {}

        listing.innerHTML += `
          <tr>
            <td><a href="${item.name}${item.type === 'dir' ? '/' : ''}">${item.name}${item.type === 'dir' ? '/' : ''}</a></td>
            <td>${lastModified}</td>
            <td class="right">${item.type === 'file' ? formatSize(item.size) : ''}</td>
            <td class="desc"></td>
          </tr>
        `;
      }
    }

    renderListing(path);
  </script>
</body>
</html>
